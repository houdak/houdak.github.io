---
import Layout from '../layouts/Layout.astro';
const firstName = "Houda";
const lastName = "Khaled";

// Fetch podcast data from public Substack RSS feed at build time
interface Episode { title: string; link: string; date: string; desc: string; }

let podcastCover = '';
let podcastDescription = '';
let episodes: Episode[] = [];

try {
	const xml = await fetch('https://frivolousscience.substack.com/feed').then(r => r.text());
	const channelPart = xml.split('<item>')[0];

	// Cover art: extract original high-res URL embedded inside the CDN URL
	const cdnUrl = (channelPart.match(/<image>[\s\S]*?<url>([\s\S]*?)<\/url>/) || [])[1] ?? '';
	const encodedOriginal = cdnUrl.match(/https%3A%2F%2F.+$/)?.[0] ?? '';
	podcastCover = encodedOriginal ? decodeURIComponent(encodedOriginal) : cdnUrl;

	// Description
	podcastDescription = (channelPart.match(/<description><!\[CDATA\[(.*?)\]\]><\/description>/) || [])[1] ?? '';

	// Episodes
	episodes = [...xml.matchAll(/<item>([\s\S]*?)<\/item>/g)].map(m => {
		const item = m[1];
		return {
			title: (item.match(/<title><!\[CDATA\[(.*?)\]\]><\/title>/) || [])[1] ?? '',
			link:  (item.match(/<link>(.*?)<\/link>/) || [])[1] ?? '',
			date:  (item.match(/<pubDate>(.*?)<\/pubDate>/) || [])[1] ?? '',
			desc:  (item.match(/<description><!\[CDATA\[(.*?)\]\]><\/description>/) || [])[1] ?? '',
		};
	}).filter(ep => !ep.title.toLowerCase().includes('coming soon')).slice(0, 6);
} catch { /* silently fall back */ }

function fmtDate(s: string) {
	try { return new Date(s).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }); }
	catch { return ''; }
}
---

<Layout title="Houda Khaled">
	<main>

		<header>
			<p class="eyebrow">Neuroscience PhD Candidate &middot; NYU</p>
			<p class="acq-params" aria-hidden="true">
				<span>λex 488 / 561 / 405 nm</span>
				<span>&middot;</span>
				<span>100× oil immersion</span>
				<span>&middot;</span>
				<span>GFP · mCherry · DAPI</span>
			</p>
			<h1>
				<span class="name-row">
					{firstName.split('').map((char, i) => (
						<span class="char" style={`--d: ${i * 0.1}s`}>{char}</span>
					))}
				</span>
				<span class="name-row row-2">
					{lastName.split('').map((char, i) => (
						<span class="char" style={`--d: ${(i + firstName.length + 1) * 0.1}s`}>{char}</span>
					))}
				</span>
			</h1>
			<div class="rule"></div>
		</header>

		<div class="ticker-wrap" aria-hidden="true">
			<div class="ticker">
				{[0, 1].map(() => (
					<span class="ticker-track">
						Synapses &nbsp;/&nbsp; Learning &amp; Memory &nbsp;/&nbsp; Huntington&rsquo;s Disease &nbsp;/&nbsp; Zebra Finch &nbsp;/&nbsp; Frivolous Science &nbsp;/&nbsp; Foster Cats &nbsp;/&nbsp; Queens, NY &nbsp;/&nbsp; Molecular Signaling &nbsp;/&nbsp; Neural Plasticity &nbsp;/&nbsp;
					</span>
				))}
			</div>
		</div>

		<section id="about" class="reveal">
			<div class="about-grid">
				<div class="photo-wrap">
					<img src="/houda.jpg" alt="Houda Khaled" />
					<div class="photo-label" aria-hidden="true">DAPI · CFP</div>
				</div>
				<div class="bio">
					<p>
						I&rsquo;m a PhD candidate in the lab of <a href="https://med.nyu.edu/faculty/richard-w-tsien" target="_blank" rel="noopener noreferrer">Dr. Richard Tsien</a> at New York University, studying the basics of how we learn. My thesis investigates when and where molecular signals trigger changes in neuronal synapses that underlie learning and memory.
					</p>
					<p>
						Previously, I worked on a small molecule therapeutic screen for <a href="https://www.hopkinsmedicine.org/psychiatry/research/neurobiology/genetic-margolis" target="_blank" rel="noopener noreferrer">Huntington&rsquo;s Disease</a> and studied structural plasticity of synapses in <a href="https://www.wellesley.edu/people/sharon-gobes" target="_blank" rel="noopener noreferrer">zebra finch brains</a> as the birds learn to sing.
					</p>
					<p>
						I also host <a href="https://linktr.ee/frivolousscience" target="_blank" rel="noopener noreferrer"><strong>Frivolous Science</strong></a>, a podcast where I interview scientists conducting unconventional research.
					</p>
					<p>
						I live in Queens, often accompanied by <a href="https://www.instagram.com/evkitties/" target="_blank" rel="noopener noreferrer">foster cats</a>.
					</p>
				</div>
			</div>
		</section>

		<section id="links" class="reveal">
			<a class="pill" href="https://www.linkedin.com/in/houda-khaled/" target="_blank" rel="noopener noreferrer">LinkedIn ↗</a>
			<a class="pill" href="mailto:hkhaled@nyu.edu">Email ↗</a>
		</section>

		<section id="podcast" class="reveal">
			<p class="section-label">Podcast</p>

			<div class="podcast-header">
				{podcastCover && (
					<div class="podcast-cover-wrap">
						<img src={podcastCover} alt="Frivolous Science podcast cover" />
					</div>
				)}
				<div class="podcast-meta">
					<h2 class="podcast-title">Frivolous Science</h2>
					<p class="podcast-desc">{podcastDescription}</p>
					<div class="podcast-ctas">
						<a
							href="https://open.spotify.com/show/1hXVgH14BLz2T5I5PSC2Gu"
							target="_blank"
							rel="noopener noreferrer"
							class="cta-link"
						>
							<svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"/></svg>
							Open in Spotify
						</a>
						<a
							href="https://frivolousscience.substack.com"
							target="_blank"
							rel="noopener noreferrer"
							class="cta-link"
						>
							Website ↗
						</a>
					</div>
				</div>
			</div>

			{episodes.length > 0 && (
				<div class="episodes-wrap">
					<p class="episodes-label">Recent Episodes</p>
					<ol class="episode-list">
						{episodes.map(ep => (
							<li class="episode-item">
								<a href={ep.link} target="_blank" rel="noopener noreferrer" class="episode-link">
									<div class="episode-main">
										<span class="episode-title">{ep.title}</span>
										{ep.desc && <span class="episode-desc">{ep.desc}</span>}
									</div>
									<div class="episode-right">
										{ep.date && <time class="episode-date">{fmtDate(ep.date)}</time>}
										<span class="episode-arrow" aria-hidden="true">↗</span>
									</div>
								</a>
							</li>
						))}
					</ol>
				</div>
			)}
		</section>

	</main>
</Layout>

<script>
	document.addEventListener('astro:page-load', () => {
		const reveals = document.querySelectorAll<HTMLElement>('.reveal');
		const io = new IntersectionObserver((entries) => {
			entries.forEach(e => {
				if (e.isIntersecting) {
					(e.target as HTMLElement).classList.add('in-view');
					io.unobserve(e.target);
				}
			});
		}, { threshold: 0.1 });
		reveals.forEach(el => io.observe(el));
	});
</script>

<style>
	main {
		position: relative;
		z-index: 1;
		max-width: 900px;
		margin: 0 auto;
		padding: 3.5rem 1.5rem 7rem;
	}

	/* ── Header ── */
	header { margin-bottom: 0; }

	.eyebrow {
		font-family: 'Space Mono', monospace;
		font-size: 0.7rem;
		letter-spacing: 0.14em;
		text-transform: uppercase;
		color: var(--ink-muted);
		opacity: 0;
		animation: fadeUp 1s ease 0.2s forwards;
		margin-bottom: 0.4rem;
	}

	/* Fake acquisition parameters — like metadata overlaid on a micrograph */
	.acq-params {
		display: flex;
		flex-wrap: wrap;
		gap: 0.5rem;
		font-family: 'Space Mono', monospace;
		font-size: 0.64rem;
		color: var(--ink-muted);
		opacity: 0;
		animation: fadeUp 1s ease 0.45s forwards;
		margin-bottom: 1.1rem;
	}
	.acq-params span:nth-child(1) { color: var(--gfp);    opacity: 0.7; }
	.acq-params span:nth-child(2) { color: var(--ink-muted); }
	.acq-params span:nth-child(3) { color: var(--ink-muted); opacity: 0.7; }
	.acq-params span:nth-child(4) { color: var(--ink-muted); }
	.acq-params span:nth-child(5) { color: var(--mcherry);  opacity: 0.7; }

	/* ── Name heading ── */
	h1 {
		font-family: 'Space Grotesk', sans-serif;
		font-weight: 700;
		font-size: clamp(5rem, 16vw, 11rem);
		line-height: 0.9;
		letter-spacing: -0.03em;
		margin-bottom: 1.5rem;
	}

	.name-row {
		display: block;
		overflow: hidden;
	}

	/* Houda: default ink + GFP green glow */
	.name-row:not(.row-2) .char {
		color: var(--ink);
		text-shadow:
			0 0 40px rgba(57,255,20,0.35),
			0 0 90px rgba(57,255,20,0.12);
	}

	/* Khaled: mCherry color + glow */
	.row-2 .char {
		color: var(--mcherry);
		text-shadow:
			0 0 40px rgba(255,61,154,0.4),
			0 0 90px rgba(255,61,154,0.15);
	}

	/* "Coming into focus" animation — like adjusting the microscope z-dial */
	.char {
		display: inline-block;
		opacity: 0;
		transform: translateY(48px);
		filter: blur(10px);
		animation: charFocus 1.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
		animation-delay: var(--d, 0s);
	}

	@keyframes charFocus {
		to { opacity: 1; transform: translateY(0); filter: blur(0px); }
	}
	@keyframes fadeUp {
		to { opacity: 1; }
	}

	.rule {
		height: 1px;
		background: linear-gradient(to right, var(--gfp), var(--ink-dim) 55%, transparent);
		transform-origin: left center;
		transform: scaleX(0);
		animation: ruleGrow 1.6s cubic-bezier(0.16, 1, 0.3, 1) 1.4s forwards;
		margin-top: 2rem;
	}
	@keyframes ruleGrow { to { transform: scaleX(1); } }

	/* ── Ticker ── */
	.ticker-wrap {
		overflow: hidden;
		background: #000;
		border-top:    1px solid rgba(57,255,20,0.18);
		border-bottom: 1px solid rgba(57,255,20,0.18);
		padding: 0.6rem 0;
		margin: 2.5rem -1.5rem;
		user-select: none;
	}

	.ticker {
		display: flex;
		white-space: nowrap;
		animation: ticker 26s linear infinite;
	}

	.ticker-track {
		flex-shrink: 0;
		font-family: 'Space Mono', monospace;
		font-size: 0.72rem;
		color: var(--gfp);
		text-shadow: 0 0 10px rgba(57,255,20,0.5);
		letter-spacing: 0.1em;
		text-transform: uppercase;
	}

	@keyframes ticker {
		from { transform: translateX(0); }
		to   { transform: translateX(-50%); }
	}

	/* ── About ── */
	#about { margin-top: 4rem; }

	.about-grid {
		display: grid;
		grid-template-columns: 240px 1fr;
		gap: 3.5rem;
		align-items: start;
	}
	@media (max-width: 600px) {
		.about-grid { grid-template-columns: 1fr; gap: 2rem; }
	}

	/* Photo — circular like a microscope field of view */
	.photo-wrap {
		position: relative;
		display: flex;
		flex-direction: column;
		align-items: center;
		gap: 0.5rem;
	}

	.photo-wrap img {
		display: block;
		width: 100%;
		aspect-ratio: 1;
		object-fit: cover;
		border-radius: 50%;
		border: 2px solid rgba(0,255,239,0.5);
		box-shadow:
			0 0 18px rgba(0,255,239,0.35),
			0 0 50px rgba(0,255,239,0.12),
			0 0 100px rgba(0,255,239,0.05);
		cursor: crosshair;
		transition: box-shadow 0.5s ease, border-color 0.5s ease;
	}
	.photo-wrap:hover img {
		border-color: rgba(0,255,239,0.8);
		box-shadow:
			0 0 28px rgba(0,255,239,0.55),
			0 0 80px rgba(0,255,239,0.2),
			0 0 150px rgba(0,255,239,0.08);
	}

	/* Channel label overlay */
	.photo-label {
		font-family: 'Space Mono', monospace;
		font-size: 0.6rem;
		letter-spacing: 0.12em;
		text-transform: uppercase;
		color: var(--cfp);
		opacity: 0.55;
	}

	.bio p { margin-bottom: 1.1rem; }
	.bio p:last-child { margin-bottom: 0; }

	/* ── Links ── */
	#links {
		margin-top: 3rem;
		display: flex;
		flex-wrap: wrap;
		gap: 0.75rem;
	}

	/* Channel-selector style buttons */
	.pill {
		display: inline-flex;
		align-items: center;
		gap: 0.55rem;
		border: 1px solid rgba(57,255,20,0.25);
		padding: 0.5rem 1.1rem;
		text-decoration: none;
		color: var(--ink-muted);
		font-family: 'Space Mono', monospace;
		font-size: 0.7rem;
		letter-spacing: 0.08em;
		text-transform: uppercase;
		transition: border-color 0.3s, color 0.3s, box-shadow 0.3s, background 0.3s;
	}
	.pill::before {
		content: '';
		width: 6px;
		height: 6px;
		border-radius: 50%;
		background: var(--gfp);
		box-shadow: 0 0 6px var(--gfp), 0 0 12px rgba(57,255,20,0.4);
		flex-shrink: 0;
		transition: box-shadow 0.3s;
	}
	.pill:hover {
		border-color: var(--gfp);
		color: var(--gfp);
		background: rgba(57,255,20,0.05);
		box-shadow: 0 0 18px rgba(57,255,20,0.08);
	}
	.pill:hover::before {
		box-shadow: 0 0 10px var(--gfp), 0 0 22px rgba(57,255,20,0.6);
	}

	/* ── Podcast ── */
	#podcast { margin-top: 3.5rem; }

	/* Channel indicator label */
	.section-label {
		display: flex;
		align-items: center;
		gap: 0.65rem;
		font-family: 'Space Mono', monospace;
		font-size: 0.68rem;
		font-weight: 700;
		letter-spacing: 0.14em;
		text-transform: uppercase;
		color: var(--gfp);
		margin-bottom: 1.5rem;
		padding-bottom: 0.6rem;
		border-bottom: 1px solid var(--ink-dim);
	}
	.section-label::before {
		content: '';
		display: inline-block;
		width: 8px;
		height: 8px;
		border-radius: 50%;
		background: var(--gfp);
		box-shadow: 0 0 8px var(--gfp), 0 0 18px rgba(57,255,20,0.45);
		flex-shrink: 0;
	}

	.podcast-header {
		display: grid;
		grid-template-columns: 170px 1fr;
		gap: 2.5rem;
		align-items: start;
		margin-bottom: 2.5rem;
	}
	@media (max-width: 600px) {
		.podcast-header { grid-template-columns: 1fr; gap: 1.5rem; }
	}

	/* Cover art — mCherry channel glow */
	.podcast-cover-wrap img {
		display: block;
		width: 100%;
		aspect-ratio: 1;
		object-fit: cover;
		border: 1px solid rgba(255,61,154,0.35);
		box-shadow:
			0 0 18px rgba(255,61,154,0.28),
			0 0 50px rgba(255,61,154,0.08);
		transition: box-shadow 0.4s ease, border-color 0.4s ease;
	}
	.podcast-cover-wrap:hover img {
		border-color: rgba(255,61,154,0.6);
		box-shadow:
			0 0 28px rgba(255,61,154,0.45),
			0 0 80px rgba(255,61,154,0.15);
	}

	.podcast-meta {
		display: flex;
		flex-direction: column;
		gap: 0.75rem;
		padding-top: 0.2rem;
	}

	.podcast-title {
		font-family: 'Space Grotesk', sans-serif;
		font-weight: 700;
		font-size: 1.9rem;
		line-height: 1.1;
		letter-spacing: -0.02em;
		color: var(--ink);
	}

	.podcast-desc {
		font-size: 0.92rem;
		color: var(--ink-muted);
		line-height: 1.65;
	}

	.podcast-ctas {
		display: flex;
		flex-wrap: wrap;
		gap: 1.5rem;
		margin-top: 0.25rem;
	}

	.cta-link {
		display: inline-flex;
		align-items: center;
		gap: 0.45rem;
		text-decoration: none;
		font-family: 'Space Mono', monospace;
		font-size: 0.68rem;
		font-weight: 700;
		letter-spacing: 0.09em;
		text-transform: uppercase;
		color: var(--ink-muted);
		border-bottom: 1px solid rgba(255,61,154,0.4);
		padding-bottom: 2px;
		transition: color 0.2s, border-color 0.2s;
	}
	.cta-link:hover { color: var(--mcherry); border-color: var(--mcherry); }
	.cta-link svg {
		width: 13px; height: 13px;
		fill: currentColor;
		flex-shrink: 0;
	}

	/* Episodes */
	.episodes-wrap { margin-top: 0.5rem; }

	.episodes-label {
		font-family: 'Space Mono', monospace;
		font-size: 0.65rem;
		font-weight: 700;
		letter-spacing: 0.13em;
		text-transform: uppercase;
		color: var(--ink-muted);
		padding-bottom: 0.5rem;
		border-bottom: 1px solid var(--ink-dim);
	}

	.episode-list { list-style: none; }

	.episode-item { border-bottom: 1px solid var(--ink-dim); }

	.episode-link {
		display: flex;
		align-items: baseline;
		justify-content: space-between;
		gap: 1.5rem;
		padding: 0.85rem 0;
		text-decoration: none;
		color: var(--ink);
		transition: color 0.2s;
	}
	.episode-link:hover { color: var(--mcherry); }
	.episode-link:hover .episode-arrow { transform: translate(2px, -2px); }

	.episode-main {
		display: flex;
		flex-direction: column;
		gap: 0.15rem;
		min-width: 0;
	}

	.episode-title {
		font-weight: 500;
		font-size: 0.95rem;
		line-height: 1.35;
	}

	.episode-desc {
		font-size: 0.8rem;
		color: var(--ink-muted);
		white-space: nowrap;
		overflow: hidden;
		text-overflow: ellipsis;
	}

	.episode-right {
		display: flex;
		align-items: center;
		gap: 0.75rem;
		flex-shrink: 0;
	}

	.episode-date {
		font-family: 'Space Mono', monospace;
		font-size: 0.65rem;
		color: var(--ink-muted);
		white-space: nowrap;
	}

	.episode-arrow {
		font-size: 0.88rem;
		transition: transform 0.2s cubic-bezier(0.16, 1, 0.3, 1);
	}
</style>
