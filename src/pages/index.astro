---
import Layout from '../layouts/Layout.astro';
const firstName = "Houda";
const lastName = "Khaled";

// Fetch podcast data from public Substack RSS feed at build time
interface Episode { title: string; link: string; date: string; desc: string; }

let podcastCover = '';
let podcastDescription = '';
let episodes: Episode[] = [];

try {
	const xml = await fetch('https://frivolousscience.substack.com/feed').then(r => r.text());
	const channelPart = xml.split('<item>')[0];

	// Cover art: extract original high-res URL embedded inside the CDN URL
	const cdnUrl = (channelPart.match(/<image>[\s\S]*?<url>([\s\S]*?)<\/url>/) || [])[1] ?? '';
	const encodedOriginal = cdnUrl.match(/https%3A%2F%2F.+$/)?.[0] ?? '';
	podcastCover = encodedOriginal ? decodeURIComponent(encodedOriginal) : cdnUrl;

	// Description
	podcastDescription = (channelPart.match(/<description><!\[CDATA\[(.*?)\]\]><\/description>/) || [])[1] ?? '';

	// Episodes
	episodes = [...xml.matchAll(/<item>([\s\S]*?)<\/item>/g)].map(m => {
		const item = m[1];
		return {
			title: (item.match(/<title><!\[CDATA\[(.*?)\]\]><\/title>/) || [])[1] ?? '',
			link:  (item.match(/<link>(.*?)<\/link>/) || [])[1] ?? '',
			date:  (item.match(/<pubDate>(.*?)<\/pubDate>/) || [])[1] ?? '',
			desc:  (item.match(/<description><!\[CDATA\[(.*?)\]\]><\/description>/) || [])[1] ?? '',
		};
	}).filter(ep => !ep.title.toLowerCase().includes('coming soon')).slice(0, 6);
} catch { /* silently fall back */ }

function fmtDate(s: string) {
	try { return new Date(s).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }); }
	catch { return ''; }
}
---

<Layout title="Houda Khaled">
	<main>

		<header>
			<p class="eyebrow">Neuroscience PhD Candidate &middot; NYU</p>
			<h1>
				<span class="name-row">
					{firstName.split('').map((char, i) => (
						<span class="char" style={`--d: ${i * 0.06}s`}>{char}</span>
					))}
				</span>
				<span class="name-row">
					{lastName.split('').map((char, i) => (
						<span class="char" style={`--d: ${(i + firstName.length + 1) * 0.06}s`}>{char}</span>
					))}
				</span>
			</h1>
			<div class="rule"></div>
		</header>

		<div class="ticker-wrap" aria-hidden="true">
			<div class="ticker">
				{[0, 1].map(() => (
					<span class="ticker-track">
						Synapses &nbsp;&middot;&nbsp; Learning &amp; Memory &nbsp;&middot;&nbsp; Huntington&rsquo;s Disease &nbsp;&middot;&nbsp; Zebra Finch &nbsp;&middot;&nbsp; Frivolous Science &nbsp;&middot;&nbsp; Foster Cats &nbsp;&middot;&nbsp; Queens, NY &nbsp;&middot;&nbsp; Molecular Signaling &nbsp;&middot;&nbsp; Neural Plasticity &nbsp;&middot;&nbsp;
					</span>
				))}
			</div>
		</div>

		<section id="about" class="reveal">
			<div class="about-grid">
				<div class="photo-wrap">
					<img src="/houda.jpg" alt="Houda Khaled" />
				</div>
				<div class="bio">
					<p>
						I&rsquo;m a PhD candidate in the lab of <a href="https://med.nyu.edu/faculty/richard-w-tsien" target="_blank" rel="noopener noreferrer">Dr. Richard Tsien</a> at New York University, studying the basics of how we learn. My thesis investigates when and where molecular signals trigger changes in neuronal synapses that underlie learning and memory.
					</p>
					<p>
						Previously, I worked on a small molecule therapeutic screen for <a href="https://www.hopkinsmedicine.org/psychiatry/research/neurobiology/genetic-margolis" target="_blank" rel="noopener noreferrer">Huntington&rsquo;s Disease</a> and studied structural plasticity of synapses in <a href="https://www.wellesley.edu/people/sharon-gobes" target="_blank" rel="noopener noreferrer">zebra finch brains</a> as the birds learn to sing.
					</p>
					<p>
						I also host <a href="https://linktr.ee/frivolousscience" target="_blank" rel="noopener noreferrer"><strong>Frivolous Science</strong></a>, a podcast where I interview scientists conducting unconventional research.
					</p>
					<p>
						I live in Queens, often accompanied by foster cats.
					</p>
				</div>
			</div>
		</section>

		<section id="links" class="reveal">
			<a class="pill" href="https://www.linkedin.com/in/houda-khaled/" target="_blank" rel="noopener noreferrer">
				<span class="pill-tag">LinkedIn</span>
			</a>
			<a class="pill" href="mailto:hkhaled@nyu.edu">
				<span class="pill-tag">Email</span>
			</a>
		</section>

		<section id="podcast" class="reveal">
			<p class="section-label">Podcast</p>

			<div class="podcast-header">
				{podcastCover && (
					<div class="podcast-cover-wrap">
						<img src={podcastCover} alt="Frivolous Science podcast cover" />
					</div>
				)}
				<div class="podcast-meta">
					<h2 class="podcast-title">Frivolous Science</h2>
					<p class="podcast-desc">{podcastDescription}</p>
					<div class="podcast-ctas">
						<a
							href="https://open.spotify.com/show/1hXVgH14BLz2T5I5PSC2Gu"
							target="_blank"
							rel="noopener noreferrer"
							class="spotify-cta"
						>
							<svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"/></svg>
							Open in Spotify
						</a>
						<a
							href="https://frivolousscience.substack.com"
							target="_blank"
							rel="noopener noreferrer"
							class="spotify-cta"
						>
							Website ↗
						</a>
					</div>
				</div>
			</div>

			{episodes.length > 0 && (
				<div class="episodes-wrap">
					<p class="episodes-label">Recent Episodes</p>
					<ol class="episode-list">
						{episodes.map(ep => (
							<li class="episode-item">
								<a href={ep.link} target="_blank" rel="noopener noreferrer" class="episode-link">
									<div class="episode-main">
										<span class="episode-title">{ep.title}</span>
										{ep.desc && <span class="episode-desc">{ep.desc}</span>}
									</div>
									<div class="episode-right">
										{ep.date && <time class="episode-date">{fmtDate(ep.date)}</time>}
										<span class="episode-arrow" aria-hidden="true">↗</span>
									</div>
								</a>
							</li>
						))}
					</ol>
				</div>
			)}
		</section>

	</main>
</Layout>

<script>
	const reveals = document.querySelectorAll<HTMLElement>('.reveal');
	const io = new IntersectionObserver((entries) => {
		entries.forEach(e => {
			if (e.isIntersecting) {
				(e.target as HTMLElement).classList.add('in-view');
				io.unobserve(e.target);
			}
		});
	}, { threshold: 0.12 });
	reveals.forEach(el => io.observe(el));
</script>

<style>
	main {
		max-width: 860px;
		margin: 0 auto;
		padding: 3.5rem 1.5rem 6rem;
	}

	/* ── Header ── */
	header {
		margin-bottom: 0;
	}

	.eyebrow {
		font-size: 0.78rem;
		font-weight: 500;
		letter-spacing: 0.12em;
		text-transform: uppercase;
		color: var(--ink);
		opacity: 0;
		animation: fadeUp 0.6s ease forwards;
		margin-bottom: 0.75rem;
	}

	h1 {
		font-family: 'Fraunces', serif;
		font-style: italic;
		font-size: clamp(5.5rem, 16vw, 11rem);
		line-height: 0.92;
		letter-spacing: -0.02em;
		margin-bottom: 1.5rem;
	}

	.name-row {
		display: block;
		overflow: hidden;
	}

	.char {
		display: inline-block;
		opacity: 0;
		transform: translateY(60px) rotate(3deg);
		animation: charIn 0.7s cubic-bezier(0.16, 1, 0.3, 1) forwards;
		animation-delay: var(--d, 0s);
	}

	@keyframes charIn {
		to { opacity: 1; transform: translateY(0) rotate(0deg); }
	}

	@keyframes fadeUp {
		to { opacity: 1; }
	}

	.rule {
		height: 2px;
		background: var(--ink);
		transform-origin: left center;
		transform: scaleX(0);
		animation: ruleGrow 0.9s cubic-bezier(0.16, 1, 0.3, 1) 0.7s forwards;
		margin-top: 2rem;
	}

	@keyframes ruleGrow {
		to { transform: scaleX(1); }
	}

	/* ── Ticker ── */
	.ticker-wrap {
		overflow: hidden;
		background: var(--ink);
		color: var(--bg);
		padding: 0.7rem 0;
		margin: 2.5rem -1.5rem;
		user-select: none;
	}

	.ticker {
		display: flex;
		white-space: nowrap;
		animation: ticker 22s linear infinite;
	}

	.ticker-track {
		flex-shrink: 0;
		font-size: 0.8rem;
		font-weight: 500;
		letter-spacing: 0.08em;
		text-transform: uppercase;
		padding-right: 0;
	}

	@keyframes ticker {
		from { transform: translateX(0); }
		to   { transform: translateX(-50%); }
	}

	/* ── About ── */
	#about {
		margin-top: 4rem;
	}

	.about-grid {
		display: grid;
		grid-template-columns: 260px 1fr;
		gap: 3.5rem;
		align-items: start;
	}

	@media (max-width: 600px) {
		.about-grid {
			grid-template-columns: 1fr;
			gap: 2rem;
		}
	}

	.photo-wrap {
		position: relative;
	}

	.photo-wrap img {
		display: block;
		width: 100%;
		aspect-ratio: 1;
		object-fit: cover;
		position: relative;
		z-index: 1;
		border: var(--rule);
		transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
	}

	.photo-wrap::after {
		content: '';
		position: absolute;
		inset: 0;
		background: var(--accent);
		transform: translate(10px, 10px);
		z-index: 0;
		transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
	}

	.photo-wrap:hover img {
		transform: translate(-4px, -4px);
	}

	.photo-wrap:hover::after {
		transform: translate(14px, 14px);
	}

	.bio p {
		margin-bottom: 1.1rem;
	}

	.bio p:last-child { margin-bottom: 0; }

	/* ── Links ── */
	#links {
		margin-top: 3.5rem;
		display: flex;
		flex-wrap: wrap;
		gap: 1rem;
	}

	.pill {
		position: relative;
		overflow: hidden;
		display: inline-flex;
		align-items: center;
		gap: 0.75rem;
		border: var(--rule);
		padding: 0.6rem 0.6rem;
		text-decoration: none;
		color: var(--ink);
		font-weight: 500;
		font-size: 0.95rem;
		transition: color 0.3s;
	}

	.pill::before {
		content: '';
		position: absolute;
		inset: 0;
		background: var(--ink);
		transform: translateX(-101%);
		transition: transform 0.35s cubic-bezier(0.16, 1, 0.3, 1);
		z-index: 0;
	}

	.pill:hover::before { transform: translateX(0); }
	.pill:hover { color: var(--accent); }

	.pill-tag, .pill-text {
		position: relative;
		z-index: 1;
	}

	.pill-tag {
		background: var(--accent);
		color: var(--ink);
		font-size: 0.7rem;
		font-weight: 700;
		letter-spacing: 0.07em;
		text-transform: uppercase;
		padding: 0.2rem 0.55rem;
		transition: background 0.3s, color 0.3s;
	}

	.pill:hover .pill-tag {
		background: var(--accent);
		color: var(--ink);
	}

	/* ── Podcast ── */
	#podcast {
		margin-top: 3.5rem;
	}

	.section-label {
		font-size: 0.78rem;
		font-weight: 700;
		letter-spacing: 0.12em;
		text-transform: uppercase;
		margin-bottom: 1.5rem;
		padding-bottom: 0.5rem;
		border-bottom: var(--rule);
	}

	.podcast-header {
		display: grid;
		grid-template-columns: 180px 1fr;
		gap: 2.5rem;
		align-items: start;
		margin-bottom: 2.5rem;
	}

	@media (max-width: 600px) {
		.podcast-header {
			grid-template-columns: 1fr;
			gap: 1.5rem;
		}
	}

	/* Cover art — same offset-shadow treatment as the about photo */
	.podcast-cover-wrap {
		position: relative;
	}

	.podcast-cover-wrap img {
		display: block;
		width: 100%;
		aspect-ratio: 1;
		object-fit: cover;
		position: relative;
		z-index: 1;
		border: var(--rule);
		transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
	}

	.podcast-cover-wrap::after {
		content: '';
		position: absolute;
		inset: 0;
		background: var(--accent);
		transform: translate(8px, 8px);
		z-index: 0;
		transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
	}

	.podcast-cover-wrap:hover img { transform: translate(-3px, -3px); }
	.podcast-cover-wrap:hover::after { transform: translate(11px, 11px); }

	/* Podcast text */
	.podcast-meta {
		display: flex;
		flex-direction: column;
		gap: 0.75rem;
		padding-top: 0.25rem;
	}

	.podcast-title {
		font-family: 'Fraunces', serif;
		font-style: italic;
		font-size: 2rem;
		line-height: 1.1;
		letter-spacing: -0.01em;
	}

	.podcast-desc {
		font-size: 0.95rem;
		color: #444;
		line-height: 1.65;
	}

	/* Spotify CTA button */
	.podcast-ctas {
		display: flex;
		flex-wrap: wrap;
		gap: 1.25rem;
		margin-top: 0.25rem;
	}

	.spotify-cta {
		display: inline-flex;
		align-items: center;
		gap: 0.5rem;
		text-decoration: none;
		font-size: 0.78rem;
		font-weight: 700;
		letter-spacing: 0.08em;
		text-transform: uppercase;
		color: var(--ink);
		border-bottom: 2px solid var(--accent);
		padding-bottom: 2px;
		width: fit-content;
		transition: color 0.2s;
	}

	.spotify-cta:hover { color: #444; }

	.spotify-cta svg {
		width: 14px;
		height: 14px;
		fill: currentColor;
		flex-shrink: 0;
	}

	/* Episodes list */
	.episodes-wrap {
		margin-top: 0.5rem;
	}

	.episodes-label {
		font-size: 0.78rem;
		font-weight: 700;
		letter-spacing: 0.12em;
		text-transform: uppercase;
		color: #888;
		padding-bottom: 0.5rem;
		border-bottom: 1px solid #e0e0e0;
		margin-bottom: 0;
	}

	.episode-list {
		list-style: none;
	}

	.episode-item {
		border-bottom: 1px solid #e0e0e0;
	}

	.episode-link {
		display: flex;
		align-items: baseline;
		justify-content: space-between;
		gap: 1.5rem;
		padding: 0.9rem 0;
		text-decoration: none;
		color: var(--ink);
		transition: color 0.2s;
	}

	.episode-link:hover { color: #444; }

	.episode-link:hover .episode-arrow {
		transform: translate(2px, -2px);
	}

	.episode-main {
		display: flex;
		flex-direction: column;
		gap: 0.15rem;
		min-width: 0;
	}

	.episode-title {
		font-weight: 500;
		font-size: 0.95rem;
		line-height: 1.35;
	}

	.episode-desc {
		font-size: 0.82rem;
		color: #777;
		white-space: nowrap;
		overflow: hidden;
		text-overflow: ellipsis;
	}

	.episode-right {
		display: flex;
		align-items: center;
		gap: 0.75rem;
		flex-shrink: 0;
	}

	.episode-date {
		font-size: 0.78rem;
		color: #999;
		white-space: nowrap;
	}

	.episode-arrow {
		font-size: 0.9rem;
		transition: transform 0.2s cubic-bezier(0.16, 1, 0.3, 1);
	}
</style>
